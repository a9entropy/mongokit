
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Changing collection dynamically &mdash; MongoKit 0.8.0 documentation</title>
    
    <link rel="stylesheet" href="static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="MongoKit 0.8.0 documentation" href="index.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">MongoKit 0.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="changing-collection-dynamically">
<h1>Changing collection dynamically<a class="headerlink" href="#changing-collection-dynamically" title="Permalink to this headline">¶</a></h1>
<p>Each <cite>MongoDocument</cite> must have a <cite>db_host</cite>, a <cite>db_port</cite>, a <cite>db_name</cite> and a <cite>collection_name</cite>.
Those attributes are set when describing mongo documents. The connection, the db and the
collection are then automatically created and attached to the object.</p>
<p>But you might need to specify a different db or collection dynamically. For instance,
say you want to store a User by database. You can&#8217;t set the <cite>db_name</cite> and <cite>collection_name</cite>
because it will change at each user.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">strucute</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;login&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span> <span class="s">&#39;screen_name&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
<span class="gp">... </span>    <span class="c"># we can set `db_name` here...</span>
</pre></div>
</div>
<p>Mongokit allow you to change those parameters on the fly. For this, you need to create
another collection with the helper <cite>get_collection</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user_col</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s">&#39;namlook&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s">&#39;profile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we can query the database by passing our new collection :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">all</span><span class="p">({},</span> <span class="n">collection</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
<p>You can pass those value to the <cite>MongoDocument.__init__</cite> :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s">&#39;namlook&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s">&#39;profile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;namlook&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Namlook&#39;</span>
</pre></div>
</div>
<p>calling <cite>user.save()</cite> will save the objet into the database &#8216;namlook&#8217; in the collection &#8216;profile&#8217;</p>
</div>
<div class="section" id="internal-structure">
<h1>Internal structure<a class="headerlink" href="#internal-structure" title="Permalink to this headline">¶</a></h1>
<div class="section" id="schemadocument">
<h2>SchemaDocument<a class="headerlink" href="#schemadocument" title="Permalink to this headline">¶</a></h2>
<p>A <cite>SchemaDocument</cite> brings all the structure and the validation layer. It is designed to be
light and powerful with an simple api. This object is completely disconnected from the db and
can be used stand-alone in another projects. Just copy the <cite>schema_document.py</cite> and the
<cite>operators.py</cite> files. This object is pretty usefull if you wan to brings the validation layers
of mongokit into another db. You&#8217;ll need to implement all the database layer thought.</p>
</div>
<div class="section" id="mongodocument">
<h2>MongoDocument<a class="headerlink" href="#mongodocument" title="Permalink to this headline">¶</a></h2>
<p>A <cite>MongoDocument</cite> brings all mongodb related staff to the SchemaDocument.
This object defines all methods to deal with a mongod server.</p>
</div>
</div>
<div class="section" id="little-api-changes">
<h1>Little api changes<a class="headerlink" href="#little-api-changes" title="Permalink to this headline">¶</a></h1>
<p>There is a little api changes with this new changeset :</p>
<blockquote>
<div><ul class="simple">
<li><cite>MongoDocument._connection</cite> and  <cite>MongoDocument._collection</cite> are removed and replaced by</li>
</ul>
<blockquote>
<div>public one : <cite>MongoDocument.connection</cite> and <cite>MongoDocument.collection</cite>.</div></blockquote>
<ul class="simple">
<li><cite>MongoDocument.db</cite> has appeared.</li>
<li><cite>_get_connection()</cite> was removed.</li>
<li><cite>MongokitOperator</cite> is now named to <cite>SchemaOperator</cite> for more consistency.</li>
<li><cite>belong_to</cite> becomes <cite>belongs_to</cite></li>
</ul>
</div></blockquote>
<p>Note that if you stiked to the tutorial and don&#8217;t used internal methods or
attributes, you don&#8217;t need to change anything.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Changing collection dynamically</a></li>
<li><a class="reference internal" href="#internal-structure">Internal structure</a><ul>
<li><a class="reference internal" href="#schemadocument">SchemaDocument</a></li>
<li><a class="reference internal" href="#mongodocument">MongoDocument</a></li>
</ul>
</li>
<li><a class="reference internal" href="#little-api-changes">Little api changes</a></li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2009-2012, Nicolas Clairon.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>